# koishi-plugin-monetary-bank | è´§å¸é“¶è¡Œ

[![npm](https://img.shields.io/npm/v/koishi-plugin-monetary-bank?style=flat-square)](https://www.npmjs.com/package/koishi-plugin-monetary-bank) [![GitHub stars](https://img.shields.io/github/stars/BYWled/koishi-plugin-monetary-bank?style=flat-square&logo=github)](https://github.com/BYWled/koishi-plugin-monetary-bank) [![Gitee](https://img.shields.io/badge/Gitee-Project-c71d23?style=flat-square&logo=gitee&logoColor=white)](https://gitee.com/BYWled/koishi-plugin-monetary-bank)

`Provides banking related services for monetary money`

`ä¸º monetary æ’ä»¶ï¼ˆæˆ–å¤–éƒ¨é¡¹ç›®ä¸­çš„ä¸»è´§å¸è¡¨ï¼‰æä¾›è½»é‡çº§é“¶è¡ŒåŠŸèƒ½ï¼Œæ”¯æŒæ´»æœŸ/å®šæœŸå­˜æ¬¾ä¸åˆ©æ¯ç»“ç®—ã€‚`

---

**ç‰ˆæœ¬**: v2.1.0

## âœ¨ ç‰¹ç‚¹

- **å¤šæ¨¡å¼äº¤äº’**: æ”¯æŒç²¾ç¾çš„å›¾å½¢åŒ–ç•Œé¢ï¼ŒåŒæ—¶ä¹Ÿå®Œå…¨å…¼å®¹çº¯æ–‡æœ¬æ“ä½œã€‚
- **å®Œæ•´é“¶è¡ŒåŠŸèƒ½**: æ”¯æŒæ´»æœŸå­˜æ¬¾ã€å®šæœŸå­˜æ¬¾ã€å–æ¬¾ã€ä½™é¢æŸ¥è¯¢ã€‚
- **åˆ©æ¯ç³»ç»Ÿ**: æ”¯æŒæ´»æœŸ/å®šæœŸåˆ©æ¯ç»“ç®—ï¼Œå¯é…ç½®ç»“ç®—å‘¨æœŸï¼ˆæ—¥/å‘¨/æœˆï¼‰ã€‚
- **å®šæœŸç®¡ç†**: æ”¯æŒå®šæœŸå­˜æ¬¾çš„è‡ªåŠ¨è½¬å­˜ã€å»¶æœŸç»­æœŸç®¡ç†ã€‚
- **é«˜å…¼å®¹æ€§**: å…¼å®¹ `monetary` è¡¨çš„å¤šç§å­—æ®µå‘½åï¼ˆ`uid`/`id`, `value`/`balance` ç­‰ï¼‰ã€‚

## ğŸ“¦ å®‰è£…ä¸ä¾èµ–

### åŸºç¡€ä¾èµ–
- **å¿…éœ€**: `database` æœåŠ¡ï¼ˆéœ€åœ¨ Koishi ä¸­é…ç½®æ•°æ®åº“æ’ä»¶ï¼‰ã€‚
- **æ•°æ®åº“è¡¨**: 
  - `monetary_bank_int`: è®°å½•é“¶è¡Œå­˜æ¬¾ï¼ˆæ´»æœŸ/å®šæœŸï¼‰ã€‚
  - `monetary` (æˆ–é…ç½®çš„è¡¨å): ç”¨æˆ·ä¸»è´§å¸è¡¨ã€‚

### å›¾å½¢åŒ–ä¾èµ–ï¼ˆå¯é€‰ï¼‰
è¦å¯ç”¨å›¾å½¢åŒ–ç•Œé¢ï¼Œè¯·å®‰è£… `puppeteer` æ’ä»¶ï¼š

```bash
# åœ¨ Koishi æ’ä»¶å¸‚åœºæœç´¢å®‰è£…
puppeteer
```

è‹¥æœªå®‰è£… puppeteerï¼Œæ’ä»¶å°†è‡ªåŠ¨ä»¥**çº¯æ–‡æœ¬æ¨¡å¼**è¿è¡Œï¼ŒåŠŸèƒ½ä¸å—å½±å“ã€‚

### âš ï¸ é‡è¦æç¤ºï¼šçƒ­é‡è½½ä¸æœåŠ¡æ³¨å†Œ

æœ¬æ’ä»¶ä½¿ç”¨ `ctx.provide()` æ³¨å†Œ `monetaryBank` æœåŠ¡ä¾›å…¶ä»–æ’ä»¶è°ƒç”¨ã€‚ä¸ºäº†æ”¯æŒçƒ­é‡è½½ï¼ˆé…ç½®ä¿®æ”¹åè‡ªåŠ¨é‡å¯ï¼‰ï¼Œæ’ä»¶å†…éƒ¨å·²å®ç°**æœåŠ¡æ³¨å†Œæ£€æµ‹æœºåˆ¶**ï¼š

- âœ… **æ­£å¸¸æƒ…å†µ**: æ’ä»¶ä¼šæ£€æµ‹æœåŠ¡æ˜¯å¦å·²æ³¨å†Œï¼Œé¿å…é‡å¤æ³¨å†Œã€‚
- âš ï¸ **å¯èƒ½çš„æŠ¥é”™**: åœ¨æŸäº› Koishi ç¯å¢ƒä¸‹ï¼Œçƒ­é‡è½½æ—¶å¯èƒ½ä»ä¼šå‡ºç°ä»¥ä¸‹è­¦å‘Šï¼š
  ```
  service monetaryBank has been registered
  ```
  æˆ–
  ```
  property monetaryBank is not registered
  ```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **å¿½ç•¥è­¦å‘Š**: è¿™äº›è­¦å‘Šä¹Ÿè®¸ä¸å½±å“æ’ä»¶æ­£å¸¸ä½¿ç”¨ï¼Œä»…ä¸ºæœåŠ¡æ³¨å†Œçš„é‡å¤æ£€æµ‹æç¤ºã€‚
2. **é‡å¯ Koishi**: å¦‚æœé‡åˆ°åŠŸèƒ½å¼‚å¸¸ï¼Œå®Œå…¨é‡å¯ Koishi è¿›ç¨‹å³å¯è§£å†³ã€‚
3. **é¿å…é¢‘ç¹çƒ­é‡è½½**: å°½é‡åœ¨é…ç½®å®Œæˆåå†å¯ç”¨æ’ä»¶ï¼Œå‡å°‘çƒ­é‡è½½æ¬¡æ•°ã€‚

**æŠ€æœ¯è¯´æ˜**: æ’ä»¶å·²å®ç° `ctx.registry` æ£€æµ‹ + `try/catch` é˜²æŠ¤ï¼Œä½†ä¸åŒç‰ˆæœ¬çš„ Koishi å¯¹æœåŠ¡æ³¨å†Œçš„å¤„ç†æœºåˆ¶å¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œå¯¼è‡´è­¦å‘Šä»å¯èƒ½å‡ºç°ã€‚è¿™ä¸ä¼šå½±å“æ’ä»¶æ ¸å¿ƒåŠŸèƒ½çš„ç¨³å®šæ€§ã€‚

## âš™ï¸ é…ç½®è¯´æ˜

åœ¨ Koishi æ’ä»¶é…ç½®ä¸­ï¼š

```yaml
plugins:
  'monetary-bank':
    defaultCurrency: 'coin'    # é»˜è®¤è´§å¸
    debug: true                # è¾“å‡ºè°ƒè¯•æ—¥å¿—
    enableInterest: true       # å¯ç”¨åˆ©æ¯ä¸å®šæœŸåŠŸèƒ½
    
    # æ´»æœŸåˆ©æ¯é…ç½®
    demandInterest:
      enabled: true
      rate: 0.25               # åˆ©ç‡ (%)
      cycle: 'day'             # ç»“ç®—å‘¨æœŸ: day/week/month
      
    # å®šæœŸæ–¹æ¡ˆåˆ—è¡¨
    fixedInterest:
      - name: 'å‘¨å®šæœŸ'
        rate: 4.35
        cycle: 'week'
      - name: 'æœˆå®šæœŸ'
        rate: 50.0
        cycle: 'month'
```

## ğŸ® å‘½ä»¤ä¸åŠŸèƒ½

æœ¬æ’ä»¶æä¾›äº†ä¸€å¥—å®Œæ•´çš„é“¶è¡ŒæŒ‡ä»¤ã€‚å½“ puppeteer å¯ç”¨æ—¶ï¼Œè¿™äº›å‘½ä»¤å°†å±•ç¤ºç²¾ç¾çš„å›¾å½¢åŒ–ç•Œé¢ã€‚

### ğŸ  é“¶è¡Œé¦–é¡µ `bank`
- **åŠŸèƒ½**: æŸ¥çœ‹è´¦æˆ·æ€»è§ˆå’ŒåŠŸèƒ½å¯¼èˆªã€‚
- **å›¾å½¢åŒ–**: å±•ç¤ºç°é‡‘ä½™é¢ã€é“¶è¡Œæ€»èµ„äº§å¡ç‰‡ï¼Œä»¥åŠæ‰€æœ‰å¯ç”¨å‘½ä»¤çš„ç½‘æ ¼å¯¼èˆªã€‚
- **æ–‡æœ¬æ¨¡å¼**: æ˜¾ç¤ºç®€å•çš„è´¦æˆ·ä½™é¢å’Œå¸®åŠ©ä¿¡æ¯ã€‚

### ğŸ’° ä½™é¢æŸ¥è¯¢ `bank.bal`
- **é€‰é¡¹**: `-c <currency>` æŒ‡å®šè´§å¸ã€‚
- **å›¾å½¢åŒ–**: å¤§æ ‡é¢˜å±•ç¤ºæ€»èµ„äº§ï¼Œç½‘æ ¼å¸ƒå±€å±•ç¤ºæ´»æœŸ/å®šæœŸå æ¯”åŠç™¾åˆ†æ¯”å¯è§†åŒ–ã€‚

### ğŸ“¥ å­˜æ¬¾ `bank.in <amount>`
- **å‚æ•°**: `amount` (é‡‘é¢æˆ– `all`)ã€‚
- **é€‰é¡¹**: `-c <currency>` æŒ‡å®šè´§å¸ï¼Œ`-y` è·³è¿‡ç¡®è®¤ã€‚
- **æµç¨‹**: 
  1. è¾“å…¥é‡‘é¢ã€‚
  2. **ç¡®è®¤é¡µé¢**ï¼ˆå›¾å½¢åŒ–ï¼‰ï¼šæ˜¾ç¤ºå­˜æ¬¾å‰åä½™é¢å¯¹æ¯”ã€æ¸©é¦¨æç¤ºã€‚
  3. **æˆåŠŸé¡µé¢**ï¼ˆå›¾å½¢åŒ–ï¼‰ï¼šå±•ç¤ºå­˜å…¥é‡‘é¢ã€æœ€æ–°èµ„äº§åˆ†å¸ƒã€‚

### ğŸ“¤ å–æ¬¾ `bank.out <amount>`
- **å‚æ•°**: `amount` (é‡‘é¢æˆ– `all`)ã€‚
- **é€‰é¡¹**: `-c <currency>` æŒ‡å®šè´§å¸ï¼Œ`-y` è·³è¿‡ç¡®è®¤ã€‚
- **æµç¨‹**:
  1. è¾“å…¥é‡‘é¢ï¼ˆä»…é™æå–æ´»æœŸä½™é¢ï¼‰ã€‚
  2. **ç¡®è®¤é¡µé¢**ï¼ˆå›¾å½¢åŒ–ï¼‰ï¼šæ˜¾ç¤ºå–æ¬¾é‡‘é¢ã€å‰©ä½™æ´»æœŸé¢„è§ˆã€‚
  3. **æˆåŠŸé¡µé¢**ï¼ˆå›¾å½¢åŒ–ï¼‰ï¼šå±•ç¤ºå–å‡ºé‡‘é¢ã€ç°é‡‘/é“¶è¡Œä½™é¢å¯¹æ¯”ã€‚

### ğŸ”’ å®šæœŸå­˜æ¬¾ `bank.fixed`
- **åŠŸèƒ½**: ç”³è¯·å®šæœŸå­˜æ¬¾ã€‚
- **å›¾å½¢åŒ–**: 
  - **æ–¹æ¡ˆé€‰æ‹©é¡µ**: åˆ—è¡¨å±•ç¤ºæ‰€æœ‰å®šæœŸæ–¹æ¡ˆï¼ˆåˆ©ç‡/å‘¨æœŸï¼‰ï¼Œæ˜¾ç¤ºå½“å‰å¯ç”¨èµ„é‡‘ï¼ˆç°é‡‘+æ´»æœŸï¼‰ã€‚
  - **ç¡®è®¤é¡µ**: ç¡®è®¤å­˜æ¬¾é‡‘é¢ä¸æ–¹æ¡ˆè¯¦æƒ…ã€‚

### ğŸ“‹ å®šæœŸç®¡ç† `bank.fixed.manage`
- **åŠŸèƒ½**: æŸ¥çœ‹å’Œç®¡ç†å·²æœ‰çš„å®šæœŸå­˜æ¬¾ã€‚
- **å›¾å½¢åŒ–**: åˆ—è¡¨å¼å±•ç¤ºæ‰€æœ‰å®šæœŸè®°å½•ï¼ŒåŒ…å«åˆ°æœŸæ—¶é—´ã€åˆ©ç‡ã€å»¶æœŸçŠ¶æ€æ ‡ç­¾ã€‚

## ğŸ¨ å›¾å½¢åŒ–ç³»ç»Ÿè®¾è®¡

### è§†è§‰é£æ ¼ (v2.0.0+)
- **ä¸»é¢˜**: è½»ç›ˆæ¸å˜ï¼ˆ#eef2f7 â†’ #f5f7fbï¼‰ï¼Œç°ä»£å¡ç‰‡å¼å¸ƒå±€ï¼Œåœ†è§’è®¾è®¡ã€‚
- **è‰²å½©**: 
  - ä¸»è‰²è°ƒï¼šç´«è“æ¸å˜ï¼ˆ#5b7cfa â†’ #7f5af0ï¼‰ç”¨äºå…³é”®ä¿¡æ¯å±•ç¤ºã€‚
  - çŠ¶æ€è‰²ï¼šæˆåŠŸ #4ade80 / ä¿¡æ¯ #60a5fa / è­¦å‘Š #fbbf24ã€‚
- **äº¤äº’**: æ‚¬åœæ•ˆæœã€å¹³æ»‘è¿‡æ¸¡ã€æ¸…æ™°çš„è§†è§‰å±‚çº§ã€‚
- **ç»„ä»¶åŒ–**: ç»Ÿä¸€çš„å¤´éƒ¨ã€ä½™é¢å¡ç‰‡ã€ä¿¡æ¯è¡Œã€å‘½ä»¤ç½‘æ ¼ã€æç¤ºæ¡†ã€ç¡®è®¤å¯¹è¯æ¡†ç­‰å¯å¤ç”¨ç»„ä»¶ã€‚
- **å“åº”å¼**: ç½‘æ ¼å¸ƒå±€è‡ªé€‚åº”ï¼ˆ`repeat(auto-fit, minmax(210px, 1fr))`ï¼‰ï¼Œæ”¯æŒä¸åŒå†…å®¹å®½åº¦ã€‚

### æ ¸å¿ƒç»„ä»¶ (`src/templates.ts`)
```typescript
// åŸºç¡€æ¨¡æ¿ï¼ˆåŒ…å«å…¨å±€æ ·å¼ï¼‰
getBaseTemplate(content: string, width?: number): string

// é¡µé¢å¤´éƒ¨ï¼ˆå›¾æ ‡ + æ ‡é¢˜ + ç”¨æˆ·åï¼‰
renderHeader(icon: string, title: string, username: string): string

// ä½™é¢å¤§æ ‡é¢˜å¡ç‰‡
renderBalanceCard(label: string, value: number, currency: string): string

// ç½‘æ ¼ä¿¡æ¯é¡¹ï¼ˆæ”¯æŒå¤šç§ä¸»é¢˜è‰²ï¼‰
renderGridItem(icon, title, value, subtitle, type): string

// ä¿¡æ¯è¡Œï¼ˆæ ‡ç­¾-å€¼å¯¹ï¼‰
renderInfoRow(label: string, value: string, valueClass?: ''|'success'|'error'): string

// å‘½ä»¤å¯¼èˆªç½‘æ ¼
renderCommandGrid(commands: Array<{icon, name, desc}>): string

// æç¤ºä¿¡æ¯æ¡†
renderPromptBox(title: string, message: string, type?: 'info'|'warning'|'success'): string

// ç¡®è®¤å¯¹è¯æ¡†
renderConfirmDialog(title: string, items: Array<{label, value}>): string
```

### é™çº§ç­–ç•¥
å¦‚æœ puppeteer ä¸å¯ç”¨æˆ–æ¸²æŸ“å¤±è´¥ï¼š
- âœ… æ‰€æœ‰åŠŸèƒ½ä¿æŒæ­£å¸¸å·¥ä½œã€‚
- âœ… è‡ªåŠ¨åˆ‡æ¢ä¸ºçº¯æ–‡æœ¬è¾“å‡ºã€‚
- âœ… äº¤äº’é€»è¾‘ä¿æŒä¸€è‡´ã€‚
- âœ… ç”¨æˆ·ä½“éªŒæ— ç¼åˆ‡æ¢ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

## ğŸ”Œ API æ¥å£

æ’ä»¶æ³¨å†Œäº† `ctx.monetaryBank` æœåŠ¡ï¼Œä¾›å…¶ä»–æ’ä»¶è°ƒç”¨ï¼š

```typescript
// æŸ¥è¯¢ä½™é¢
const balance = await ctx.monetaryBank.getBalance(uid, 'coin');
// { total: 1000, demand: 800, fixed: 200 }

// å­˜æ¬¾
const res = await ctx.monetaryBank.deposit(uid, 'coin', 100);
// { success: true, newCash: 50, newBalance: { ... } }

// å–æ¬¾
const res2 = await ctx.monetaryBank.withdraw(uid, 'coin', 50);
```

## ğŸ“… åˆ©æ¯ç»“ç®—

è‹¥å¯ç”¨ `enableInterest`ï¼Œæ’ä»¶ä¼šå¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼ˆæ¯æ—¥0ç‚¹ï¼‰ï¼š
- æ£€æŸ¥åˆ°æœŸçš„å®šæœŸå­˜æ¬¾ã€‚
- æ ¹æ®ç”¨æˆ·è®¾ç½®ï¼ˆè‡ªåŠ¨å»¶æœŸæˆ–è½¬æ´»æœŸï¼‰è¿›è¡Œå¤„ç†ã€‚
- ç»“ç®—æ´»æœŸåˆ©æ¯ï¼ˆæŒ‰é…ç½®å‘¨æœŸï¼‰ã€‚
- è‡ªåŠ¨åˆå¹¶ç¢ç‰‡åŒ–çš„æ´»æœŸè®°å½•ä»¥ä¼˜åŒ–æ€§èƒ½ã€‚

## ğŸ’» å¼€å‘æ‰©å±•

### æ‰©å±•å›¾å½¢åŒ–é¡µé¢
æ’ä»¶å†…éƒ¨ä½¿ç”¨ `src/templates.ts` ä¸­çš„ç»„ä»¶æ„å»ºé¡µé¢ã€‚å¼€å‘è€…å¯å‚è€ƒä»¥ä¸‹æ¨¡å¼æ‰©å±•ï¼š

```typescript
import { renderHeader, renderBalanceCard, renderPromptBox, getBaseTemplate } from './templates';

// æ„å»º HTML å†…å®¹
const content = `
  ${renderHeader('ğŸ¯', 'è‡ªå®šä¹‰é¡µé¢', username)}
  ${renderBalanceCard('æ•°æ®å±•ç¤º', 1000, 'coin')}
  ${renderPromptBox('æç¤º', 'è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰é¡µé¢', 'info')}
`;

// ç”Ÿæˆå®Œæ•´ HTML
const html = getBaseTemplate(content);

// æ¸²æŸ“ä¸ºå›¾ç‰‡ (éœ€å¤„ç† puppeteer ä¾èµ–)
const image = await ctx.puppeteer.render(html);
```

## ğŸ“ æ›´æ–°æ—¥å¿—

è¯¦ç»†çš„æ›´æ–°æ—¥å¿—è¯·æŸ¥çœ‹ [CHANGELOG.md](CHANGELOG.md)ã€‚

---

**å¼€å‘è€…**: BYWled
**ä»“åº“**: `koishi-plugin-monetary-bank`

èŒæ–°ç¼–å†™ï¼Œéƒ¨åˆ†å€ŸåŠ©äº†AIçš„åŠ›é‡ï¼Œè‹¥æœ‰çº°æ¼ï¼Œè¿˜æœ›æµ·æ¶µQwQ
